!function(e){var t=e.module("DeferredWithMultipleUpdates",[]);t.service("DeferredWithMultipleUpdates",["$q",function(e){this.all=function(){return e.all.apply(e,arguments)},this.defer=function(){var t=e.defer(),n=t.promise,r={resolve:t.resolve,reject:t.reject,then:n.then},a=!1,o=!1,u=[],i=[];return t.resolve=function(){if(a&&!o)for(var e=0,n=u.length;n>e;e++)u[e].apply({},arguments);else a=!0,r.resolve.apply(t,arguments)},t.reject=function(){if(a)for(var e=0,n=i.length;n>e;e++)i[e].apply({},arguments);else o=!0,r.reject.apply(t,arguments)},n.then=function(e,t){var a=r.then.apply(n,arguments);return e&&u.push(e),t&&i.push(t),a},t},this.reject=function(t){return rejectCallbacks.push(t),e.reject.apply(e,arguments)},this.when=function(){return e.when.apply(e,arguments)}}])}(angular),function(){var e;e=angular.module("jt-resource-factory",["DeferredWithMultipleUpdates"]).service("jtCacheService",["DSCacheFactory","ENV","$log",function(e,t,n){var r;return new(r=function(){function e(){}return e.prototype.get=function(e){var t;if((t=localStorage.getItem(e))&&"undefined"!==t)return JSON.parse(t)},e.prototype.put=function(e,t){return localStorage.setItem(e,JSON.stringify(t))},e.prototype.shouldUpdate=function(e,t){return this.get(""+e+"-etag")!==t("etag")},e.prototype.update=function(e,t,r,a){var o,u,i;null==a&&(a=!0),r=angular.copy(r);for(u in r)i=r[u],0===u.indexOf("$")&&delete r[u];return(o="function"==typeof t?t("etag"):void 0)&&this.put(""+e+"-etag",o),a&&n.debug("jtCacheService.update:",e,r),this.put(e,r)},e}())}]).service("jtNetworkConnection",["$rootScope",function(e){var t;return new(t=function(){function t(){}return t.prototype.onOnline=function(t){var n;return n=function(){return e.$applyAsync(t)},"undefined"!=typeof Offline&&null!==Offline&&Offline.on("up",n),function(){return"undefined"!=typeof Offline&&null!==Offline?Offline.off("up",n):void 0}},t}())}]).factory("jtResourceFactory",["DeferredWithMultipleUpdates","jtCacheService","$http","jtNetworkConnection","$log",function(e,t,n,r){var a;return a=function(){function a(){}return a.prototype._createApiResource=function(a){var o,u,i,l,f,c,s,p,d,g,h,y,v,$,m,j,O;return o=a.$httpParams,j=a.transformResponse,g=a.isArray,u=a.cache,i=a.cacheKey,y=a.retryIfFails,m=a.transformCacheBefore,$=a.transformCacheAfter,v=u,null==v&&(v="GET"===o.method),null==i&&(i=this._generateCacheKey(o.url,o.params)),null==y&&(y=v),null==m&&(m=angular.identity),null==$&&($=angular.identity),null==j&&(j=angular.identity),null==g&&(g=!1),p=e.defer(),s=e.defer(),h=g?[]:{},h.$promise=p.promise,h.$networkPromise=s.promise,h.$resolved=!1,h.$failed=!1,h.$loading=!0,h.$resolveWith=function(e){var t,n,r;if(h.$data)if(angular.isArray(h.$data))h.splice(0,h.length);else if(angular.isObject(h.$data)){r=h.$data;for(t in r)n=r[t],delete h[t]}return h.$data=e,d(e),p.resolve(e),s.resolve(e)},d=function(e){return angular.extend(h,e)},v&&(l=t.get(i))&&(h.$resolved=!0,h.$loading=!1,c=$(angular.copy(l)),d(c),p.resolve(c)),f=function(){return h.$networkLoading=!0,n(o).success(function(e,n,r){var a;return h.$resolved=!0,h.$failed=!1,e=j(e),v&&t.shouldUpdate(i,r)?(a=m(angular.copy(e)),t.update(i,r,a),h.$resolveWith(e)):h.$resolveWith(e)}).error(function(e,t,n,r){return h.$failed=!0,p.reject({data:e,status:t,headers:n,config:r}),s.reject({data:e,status:t,headers:n,config:r})})["finally"](function(){return h.$loading=!1,h.$networkLoading=!1})},f(),h.$retry=function(){return f()},y&&(O=null,h.$networkPromise["catch"](function(){return O||(O=r.onOnline(function(){return h.$failed&&!h.$networkLoading?h.$retry():void 0}))}),h.$networkPromise.then(function(){return O?(O(),O=null):void 0})),h},a.prototype._generateCacheKey=function(e,t){var n,r;t=angular.copy(t||{}),delete t.auth_token,delete t.token;for(n in t)r=t[n],angular.isNumber(r)&&(t[n]=r.toString()),null==r&&delete t[n];return e+(angular.equals({},t)?"":JSON.stringify(t))},a}()}])}.call(this);
