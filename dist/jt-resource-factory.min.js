!function(e){var t=e.module("DeferredWithMultipleUpdates",[]);t.service("DeferredWithMultipleUpdates",["$q",function(e){this.all=function(){return e.all.apply(e,arguments)},this.defer=function(){var t=e.defer(),n=t.promise,r={resolve:t.resolve,reject:t.reject,then:n.then},o=!1,a=!1,i=[],u=[];return t.resolve=function(){if(o&&!a)for(var e=0,n=i.length;e<n;e++)i[e].apply({},arguments);else o=!0,r.resolve.apply(t,arguments)},t.reject=function(){if(o)for(var e=0,n=u.length;e<n;e++)u[e].apply({},arguments);else a=!0,r.reject.apply(t,arguments)},n.then=function(e,t){var o=r.then.apply(n,arguments);return e&&i.push(e),t&&u.push(t),o},t},this.reject=function(t){return rejectCallbacks.push(t),e.reject.apply(e,arguments)},this.when=function(){return e.when.apply(e,arguments)}}])}(angular),function(){var e;e=angular.module("jt-resource-factory",["DeferredWithMultipleUpdates"]).service("jtCacheService",["$log",function(e){var t;return new(t=function(){function t(){}return t.prototype.get=function(e){var t;if((t=localStorage.getItem(e))&&"undefined"!==t)return JSON.parse(t)},t.prototype.put=function(e,t){return localStorage.setItem(e,JSON.stringify(t))},t.prototype.shouldUpdate=function(e,t){return this.get(e+"-etag")!==t("etag")},t.prototype.update=function(t,n,r,o){var a,i,u;null==o&&(o=!0),r=angular.copy(r);for(u in r)i=r[u],0===u.indexOf("$")&&delete r[u];return(a="function"==typeof n?n("etag"):void 0)&&this.put(t+"-etag",a),o&&e.debug("jtCacheService.update:",t,r),this.put(t,r)},t}())}]).service("jtNetworkConnection",["$rootScope",function(e){var t;return new(t=function(){function t(){}return t.prototype.onOnline=function(t){var n;return n=function(){return e.$applyAsync(t)},"undefined"!=typeof Offline&&null!==Offline&&Offline.on("up",n),function(){return"undefined"!=typeof Offline&&null!==Offline?Offline.off("up",n):void 0}},t}())}]).factory("jtResourceFactory",["DeferredWithMultipleUpdates","jtCacheService","$http","jtNetworkConnection","$log",function(e,t,n,r,o){var a;return a=function(){function o(){}return o.prototype._createApiResource=function(o){var a,i,u,l,f,c,s,p,d,h,g,y,v,$,j,m,O;return a=o.$httpParams,m=o.transformResponse,h=o.isArray,i=o.cache,u=o.cacheKey,y=o.retryIfFails,j=o.transformCacheBefore,$=o.transformCacheAfter,v=i,null==v&&(v="GET"===a.method),null==u&&(u=this._generateCacheKey(a.url,a.params)),null==y&&(y=v),null==j&&(j=angular.identity),null==$&&($=angular.identity),null==m&&(m=angular.identity),null==h&&(h=!1),p=e.defer(),s=e.defer(),g=h?[]:{},g.$promise=p.promise,g.$networkPromise=s.promise,g.$resolved=!1,g.$failed=!1,g.$loading=!0,g.$resolveWith=function(e,t){var n,r,o;if(null==t&&(t=!0),g.$data)if(angular.isArray(g.$data))g.splice(0,g.length);else if(angular.isObject(g.$data)){r=g.$data;for(n in r)o=r[n],delete g[n]}if(g.$data=e,angular.isObject(e)&&d(e),p.resolve(e),t)return s.resolve(e)},d=function(e){return angular.extend(g,e)},v&&(l=t.get(u))&&(g.$resolved=!0,g.$loading=!1,c=$(angular.copy(l)),angular.isObject(c)&&g.$resolveWith(c,!1)),f=function(){return g.$networkLoading=!0,n(a).success(function(e,n,r,o){var a;return g.$resolved=!0,g.$failed=!1,e=m(e),v&&t.shouldUpdate(u,r)?(a=j(angular.copy(e)),t.update(u,r,a),g.$resolveWith(e)):g.$resolveWith(e)}).error(function(e,t,n,r){return g.$failed=!0,p.reject({data:e,status:t,headers:n,config:r}),s.reject({data:e,status:t,headers:n,config:r})})["finally"](function(){return g.$loading=!1,g.$networkLoading=!1})},f(),g.$retry=function(){return f()},y&&(O=null,g.$networkPromise["catch"](function(){return O||(O=r.onOnline(function(){if(g.$failed&&!g.$networkLoading)return g.$retry()}))}),g.$networkPromise.then(function(){if(O)return O(),O=null})),g},o.prototype._generateCacheKey=function(e,t){var n,r;t=angular.copy(t||{}),delete t.auth_token,delete t.token;for(n in t)r=t[n],angular.isNumber(r)&&(t[n]=r.toString()),null==r&&delete t[n];return e+(angular.equals({},t)?"":JSON.stringify(t))},o}()}])}.call(this);